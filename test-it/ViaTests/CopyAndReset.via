define(CopyAndResetTest dv(.VirtualInstrument (
    c(
        e(dv(.Boolean true) source)
        e(dv(.Boolean false) destination)
        e(dv(.Boolean false) sourceNewValue)
        e(Boolean needsUpdate)
    )
    clump (1
        Printf("CopyAndReset on a non-dataitem local (unexpected case)\n")
        Printf("Before\n")
        CheckValueNeedsUpdate(source needsUpdate)
        Printf("    needsUpdate = <%z>\n" needsUpdate)
        Printf("    source = <%s>\n" source)
        Printf("    destination = <%s>\n" destination)
        Printf("    sourceNewValue = <%s>\n" sourceNewValue)
        CopyAndReset(source destination sourceNewValue)
        Printf("After\n")
        CheckValueNeedsUpdate(source needsUpdate)
        Printf("    needsUpdate = <%z>\n" needsUpdate)
        Printf("    source = <%s>\n" source)
        Printf("    destination = <%s>\n" destination)
        Printf("    sourceNewValue = <%s>\n" sourceNewValue)
        Printf("After Second Needs Update\n")
        CheckValueNeedsUpdate(source needsUpdate)
        Printf("    needsUpdate = <%z>\n" needsUpdate)
        Printf("    source = <%s>\n" source)
        Printf("    destination = <%s>\n" destination)
        Printf("    sourceNewValue = <%s>\n" sourceNewValue)
    )
) ) )
define(CopyAndResetTestSourceDataItem dv(.VirtualInstrument (
    c(
        de(dv(.Boolean true) source)
        e(dv(.Boolean false) destination)
        e(dv(.Boolean false) sourceNewValue)
        e(Boolean needsUpdate)
    )
    clump (1
        Printf("CopyAndReset on a dataitem local (expected use case)\n")
        Printf("Before\n")
        CheckValueNeedsUpdate(source needsUpdate)
        Printf("    needsUpdate = <%z>\n" needsUpdate)
        Printf("    source = <%s>\n" source)
        Printf("    destination = <%s>\n" destination)
        Printf("    sourceNewValue = <%s>\n" sourceNewValue)
        CopyAndReset(source destination sourceNewValue)
        Printf("After\n")
        CheckValueNeedsUpdate(source needsUpdate)
        Printf("    needsUpdate = <%z>\n" needsUpdate)
        Printf("    source = <%s>\n" source)
        Printf("    destination = <%s>\n" destination)
        Printf("    sourceNewValue = <%s>\n" sourceNewValue)
        Printf("After Second Needs Update\n")
        CheckValueNeedsUpdate(source needsUpdate)
        Printf("    needsUpdate = <%z>\n" needsUpdate)
        Printf("    source = <%s>\n" source)
        Printf("    destination = <%s>\n" destination)
        Printf("    sourceNewValue = <%s>\n" sourceNewValue)
    )
) ) )
enqueue(CopyAndResetTestSourceDataItem)
enqueue(CopyAndResetTest)
