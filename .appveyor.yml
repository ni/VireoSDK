branches:
  except:
    - gh-pages
image: Visual Studio 2017
init:
- tzutil /s "Central Standard Time"
- cmd: node -v
- cmd: npm -v
- cmd: python -V
- cmd: pip -V
- ps: $PSVersionTable
install:
#  - chocolatey install make
#  - chocolatey install gnuwin32-coreutils.portable
#  - npm install
#  - pip install --user -r requirements.txt
#  - ps: Start-BitsTransfer -Source https://s3.amazonaws.com/mozilla-games/emscripten/releases/emsdk-1.35.0-portable-64bit.zip -Destination .\emsdk-1.35.0-portable-64bit.zip
#  - ps: Expand-Archive .\emsdk-1.35.0-portable-64bit.zip -DestinationPath .\emscripten-sdk
#  - emscripten-sdk\emsdk update
#  - emscripten-sdk\emsdk install sdk-1.37.9-64bit
#  - emscripten-sdk\emsdk activate sdk-1.37.9-64bit
#  - emcc -v
platform:
  - Win32
configuration:
  - Debug
before_build:
#  - ps: Start-Process npm "run httpbin" -PassThru
# TODO capture standard out and error to log at the end?
# TODO script needed to wait for server startup?
#  - make lint
#  - npm run lint
build:
  project: Vireo_VS/VireoCommandLine.sln
#after_build:
#  - make vjs
test_script:
#  - make testjs
#  - make testnative
#  - npm run karma -- --browsers PhantomJS --skip-tags FailsPhantomJS,Slow
#  - npm run karma -- --browsers Chrome,Firefox,IE
# Using the same naming convention as rust https://forge.rust-lang.org/platform-support.html

# AppVeyor does not deploy with annotated tags http://help.appveyor.com/discussions/problems/3960-build-on-tag-wrongly-thinks-its-on-a-different-branch-than-master
# branch and AppVeyor tag are mutually exclusive https://www.appveyor.com/docs/branches/#build-on-tags-github-gitlab-and-bitbucket-only
after_test:
  - 7z a esh_i686-pc-windows-msvc.zip %APPVEYOR_BUILD_FOLDER%\dist\Debug\esh.exe %APPVEYOR_BUILD_FOLDER%\dist\Debug\esh.pdb %APPVEYOR_BUILD_FOLDER%\README.md %APPVEYOR_BUILD_FOLDER%\LICENSE.txt
artifacts:
  - path: esh_i686-pc-windows-msvc.zip
    name: esh_i686-pc-windows-msvc
    type: Zip
deploy:
  provider: GitHub
  description: 'test deploy'
  auth_token:
    secure: EMHIMInThBDaSSOuGwntAOQYeqNkwNqx7Za0qlSqiFhC7UG4Q4BCKyey5k4ATi2m
  artifact: esh_i686-pc-windows-msvc
  force_update: true
  on:
    appveyor_repo_tag: true
